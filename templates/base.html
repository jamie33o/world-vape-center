{% load static %}

<!doctype html>
<html lang="en">
  <head>
    {% block meta %}
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    {% endblock %}

    {% block favicon %}
        <link rel="icon" sizes="192x192" href="{% static 'images/favicon/logo192.png' %}">
        <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/favicon/applelogo.png' %}">
        <link rel="icon" href="{% static 'images/favicon/favicon.ico' %}" type="image/x-icon">
        <link rel="icon" sizes="32x32" href="{% static 'images/favicon/logo32.png' %}">
        <link rel="icon" sizes="16x16" href="{% static 'images/favicon/logo16.png' %}">
        <link rel="icon" sizes="32x32" href="{% static 'images/favicon/logo512.png' %}">
    {% endblock %}   
    
    {% block corecss %}   
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
        <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/5.3.45/css/materialdesignicons.css" integrity="sha256-NAxhqDvtY0l4xn+YVa6WjAcmd94NNfttjNsDmNatFVc=" crossorigin="anonymous">
        <link rel="stylesheet" href="{% static 'css/base.css' %}">  
        <link rel="stylesheet" href="{% static 'home/css/home.css' %}">  
        <link rel="stylesheet" href="{% static 'products/css/product-list.css' %}">  
      
    {% endblock %}

    {% block extra_css %}
    {% endblock %}

    {% block corejs %}
        <script async src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
        <script async src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script async src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
        <script async src="https://kit.fontawesome.com/2be66b3e41.js" crossorigin="anonymous"></script>
        <script src="{% static 'js/base.js' %}"></script>
        <script src="https://js.stripe.com/v3/"></script>
        <script src="{% static 'home/js/home.js' %}"></script>
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.2.1/owl.carousel.js"></script>
        <script src="{% static 'products/js/add-to-cart.js' %}"></script>
        <script src="{% static 'products/js/product-details.js' %}"></script>
    {% endblock %}

    {% block extra_js %}
    {% endblock %}

    <title>World Vape Center</title>
  </head>
  <body class="d-flex flex-column">

    <header class="container-fluid fixed-top p-0">
      {% block page_header %}
        {% include 'ls-header.html' %}
      {% endblock %}
      {% block extra_header %}
      {% endblock %}
    </header>
  
    <main>
      {% block breadcrumb %}
      <div class="container-fluid">
        <nav aria-label="breadcrumb" class="d-none bc-con w-100">
          <ol class="breadcrumb bg-none mx-5 mt-5 p-3">
          </ol>
        </nav>
      </div>
      {% endblock %}
      {% if messages %}
      
      {% for message in messages %}
      <div class="row position-relative justify-content-end m-0 messages">
        <div class="col-sm-3 col-md-3 position-absolute mr-5">
            <div class="alert bg-{% if not message.tags == 'error' %}{{message.tags}}{% else %}danger{% endif %} mx-auto">
                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">
                    Ã—</button>
               <span class="glyphicon glyphicon-ok"></span> <strong>{{message.tags}}</strong>
                <hr class="message-inner-separator">
                <p>
                  {{ message }}</p>
            </div>
        </div>
      </div>
      {% endfor %}
      
      {% endif %}
      {% block content %}
      {% endblock %}    
    </main>

    <footer class="mt-5" id="help">
      {% block page_footer %}
        {% include 'ls-footer.html' %}
      {% endblock %}
    </footer>


    <div class="modal" id="age-modal" tabindex="-1" role="dialog">
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Age Verification</h5>
          </div>
          <div class="modal-body">
            <p>Are you 18 years old or older?</p>
            <p>By entering this site, 
              you confirm that you are 18 years old or older. 
              Age verification will be required at checkout.</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary verified" data-dismiss="modal">Yes, I'm 18+</button>
            <a href="javascript:history.back()" class="btn btn-secondary un-verified" >No, I'm under 18</a>
          </div>
        </div>
      </div>
    </div>

    {% block postloadjs %}
    <script>

      $(document).ready(function() {

        {% if cart and cart.get_cart_status %}
          $('#cart-modal').modal('show')
        {% endif %}
        
        $('.un-verified').on('click', function(){
          localStorage.setItem('firstVisit', 'true');
        })

        if(localStorage.getItem('firstVisit') != 'false') {
          $('#age-modal').modal('show');
          localStorage.setItem('firstVisit', 'false');
        }

        $('.sub').click(function(e) {
          e.preventDefault();
          let nlMsg = $('.nl-msg')
          nlMsg.empty()

          let url = $(this).data('url')

          $.ajax({
              type: 'POST',
              url: url,
              data: $('#nl_form').serialize(),
              success: function(data) {
              
                nlMsg.prepend(`<div class="bg-${data.status}  text-white"><p> ${data.message} </p></div>`);
                
              },
              error: function(xhr, textStatus, errorThrown) {
                  nlMsg.prepend('<div class="bg-danger text-white"><p>An error occurred. Please try again.</p></div>');
              }
          });
        });

          function breadcrumbsList() {
            const breadcrumbContainer = $('.breadcrumb');
            let homeItem = null;
        
            const path = window.location.pathname;
            const pathParts = path.split('/').filter(Boolean);
            if(pathParts.length > 0){
              $('.bc-con').addClass('d-lg-inline')
              homeItem = $('<li>', { class: 'breadcrumb-item' });
              let homeLink = $('<a>', { href: '/', text: 'Home' });
              homeItem.append(homeLink);

            }else{
              $('.bc-con').removeClass('d-lg-inline')
            }
        
            renderBreadcrumbs(breadcrumbContainer, pathParts, homeItem);
        }
        
        function renderBreadcrumbs(container, pathParts, homeItem) {
            container.empty();
        
            let currentPath = '';
            pathParts.forEach((part, index) => {
                currentPath += `/${part}`;
        
                const breadcrumbItem = $('<li>', { class: 'breadcrumb-item' });
                let link = $('<a>', { href: currentPath, text: part });
        
                if (index === pathParts.length - 1) {
                    link = $('<p>', { text: part });
                    link.addClass('text-dark d-inline');
                } else {
                    link.addClass('text-dark');
                }
        
                breadcrumbItem.append(link);
                container.append(breadcrumbItem);
                if(homeItem){
                  container.prepend(homeItem);
                }
            });
        }
        
    
        breadcrumbsList();
          
      });
    </script>

    {% endblock %} 

{% block extra_postloadjs %}  
{% endblock %}    
  </body>
</html>